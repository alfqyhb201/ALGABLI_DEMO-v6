<?php use Illuminate\Database\Migrations\Migration; use Illuminate\Database\Schema\Blueprint; use Illuminate\Support\Facades\Schema; class CreateSyncConflictsTable extends Migration { public function up() { Schema::create('sync_conflicts', function (Blueprint $table) { $table->bigIncrements('id'); $table->unsignedInteger('device_id')->nullable(); $table->unsignedBigInteger('user_id')->nullable(); $table->string('entity_name'); $table->char('entity_id',36)->nullable(); $table->enum('conflict_type', ['field_mismatch','duplicate','missing_record'])->nullable(); $table->json('local_data')->nullable(); $table->json('remote_data')->nullable(); $table->enum('resolution_status', ['pending','merged','overridden','ignored'])->default('pending'); $table->unsignedBigInteger('resolved_by')->nullable(); $table->timestamp('resolved_at')->nullable(); $table->timestamps(); $table->foreign('device_id')->references('id')->on('sync_devices')->onDelete('set null'); $table->foreign('user_id')->references('id')->on('users')->onDelete('set null'); $table->foreign('resolved_by')->references('id')->on('users')->onDelete('set null'); $table->index(['entity_name','resolution_status']); }); } public function down() { Schema::dropIfExists('sync_conflicts'); } }
